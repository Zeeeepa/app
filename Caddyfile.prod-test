# Test against production backend
:8080 {
    log {
        format json
    }

    # health check
    rewrite /health /*

    # Serve from 'dist' folder  
    root * dist

    # Route block to control directive execution order
    route {
        # API proxy - test against production backend
        reverse_proxy /api/* https://prod-staging.api.comfydeploy.com {
            transport http {
                tls
            }
            header_up Host {host}
            header_up X-Forwarded-Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
            header_up Forwarded "proto={scheme};host={host}"
        }

        # Static file serving with SPA fallback
        encode gzip
        try_files {path} /index.html
        file_server
    }
}
